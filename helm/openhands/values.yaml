# Default values for OpenHands Helm chart
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

## @section Global parameters
## Global Docker image parameters
## Please, note that this will override the image parameters, including dependencies, configured to use the global value
## Current available global Docker image parameters: imageRegistry, imagePullSecrets and storageClass

global:
  ## @param global.imageRegistry Global Docker image registry
  imageRegistry: ""
  ## @param global.imagePullSecrets Global Docker registry secret names as an array
  ## E.g.
  ## imagePullSecrets:
  ##   - myRegistryKeySecretName
  imagePullSecrets: []

## @section Common parameters

## @param nameOverride String to partially override common.names.fullname
nameOverride: ""
## @param fullnameOverride String to fully override common.names.fullname
fullnameOverride: ""
## @param namespaceOverride String to fully override the namespace
namespaceOverride: ""

## @section OpenHands Image parameters

## OpenHands image
image:
  ## @param image.registry OpenHands image registry
  registry: docker.io
  ## @param image.repository OpenHands image repository
  repository: openhands/openhands
  ## @param image.tag OpenHands image tag (immutable tags are recommended)
  ## Defaults to the chart appVersion
  tag: ""
  ## @param image.digest OpenHands image digest in the way sha256:aa.... Please note this parameter, if set, will override the tag
  digest: ""
  ## @param image.pullPolicy OpenHands image pull policy
  ## ref: https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy
  pullPolicy: IfNotPresent
  ## @param image.pullSecrets OpenHands image pull secrets
  ## E.g.
  ## pullSecrets:
  ##   - myRegistryKeySecretName
  pullSecrets: []

## @section Runtime (Sandbox) Image parameters

## Runtime sandbox image used for code execution
runtime:
  ## @param runtime.image Runtime container image
  ## This is the image used for the sandbox where code is actually executed
  image: docker.openhands.dev/openhands/runtime:1.1-nikolaik
  ## @param runtime.enabled Enable runtime sandbox (required for code execution)
  enabled: true

## @section OpenHands Deployment parameters

## @param replicaCount Number of OpenHands replicas to deploy
## NOTE: Multiple replicas may require shared storage configuration
replicaCount: 1

## Configure the Security Context for the Pod
## ref: https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-pod
podSecurityContext:
  ## @param podSecurityContext.enabled Enable pod security context
  enabled: true
  ## @param podSecurityContext.fsGroup Group ID for the pod
  fsGroup: 42420

## Configure the Security Context for the Container
## ref: https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-container
securityContext:
  ## @param securityContext.enabled Enable container security context
  enabled: true
  ## @param securityContext.runAsUser User ID for the container
  runAsUser: 42420
  ## @param securityContext.runAsNonRoot Force the container to run as non-root
  runAsNonRoot: true
  ## @param securityContext.privileged Run container in privileged mode (needed for Docker-in-Docker)
  privileged: false
  ## @param securityContext.allowPrivilegeEscalation Allow privilege escalation
  allowPrivilegeEscalation: false
  ## @param securityContext.readOnlyRootFilesystem Mount root filesystem as read-only
  readOnlyRootFilesystem: false
  ## @param securityContext.capabilities.drop Capabilities to drop
  capabilities:
    drop:
      - ALL

## OpenHands resource requests and limits
## ref: https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
resources:
  ## @param resources.limits.cpu CPU limit for OpenHands container
  ## @param resources.limits.memory Memory limit for OpenHands container
  limits:
    cpu: 2000m
    memory: 4Gi
  ## @param resources.requests.cpu CPU request for OpenHands container
  ## @param resources.requests.memory Memory request for OpenHands container
  requests:
    cpu: 1000m
    memory: 2Gi

## @section Service parameters

## Service configuration
service:
  ## @param service.type Kubernetes service type
  type: ClusterIP
  ## @param service.port Service HTTP port
  port: 3000
  ## @param service.targetPort Container target port
  targetPort: 3000
  ## @param service.nodePort NodePort if service type is NodePort
  ## ref: https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport
  nodePort: ""
  ## @param service.annotations Service annotations
  annotations: {}
  ## @param service.sessionAffinity Session Affinity for Kubernetes service
  ## Valid values: None, ClientIP
  sessionAffinity: None

## @section Ingress parameters

## Configure the ingress resource that allows you to access the OpenHands installation
## ref: https://kubernetes.io/docs/concepts/services-networking/ingress/
ingress:
  ## @param ingress.enabled Enable ingress record generation for OpenHands
  enabled: false
  ## @param ingress.className IngressClass that will be used to implement the Ingress
  className: ""
  ## @param ingress.annotations Additional annotations for the Ingress resource
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # cert-manager.io/cluster-issuer: letsencrypt-prod
    # nginx.ingress.kubernetes.io/proxy-body-size: "0"
    # nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
    # nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
  ## @param ingress.hosts Ingress hosts configuration
  hosts:
    - host: openhands.local
      paths:
        - path: /
          pathType: Prefix
  ## @param ingress.tls Ingress TLS configuration
  tls: []
  #  - secretName: openhands-tls
  #    hosts:
  #      - openhands.local

## @section Persistence parameters

## Persistence for workspace and file storage
persistence:
  ## @param persistence.enabled Enable persistence using Persistent Volume Claims
  enabled: true
  ## @param persistence.storageClass Persistent Volume storage class
  ## If defined, storageClassName: <storageClass>
  ## If set to "-", storageClassName: "", which disables dynamic provisioning
  ## If undefined (the default) or set to null, no storageClassName spec is set,
  ## choosing the default provisioner
  storageClass: ""
  ## @param persistence.accessModes Persistent Volume access modes
  accessModes:
    - ReadWriteOnce
  ## @param persistence.size Persistent Volume size
  size: 10Gi
  ## @param persistence.annotations Persistent Volume Claim annotations
  annotations: {}
  ## @param persistence.existingClaim Name of an existing PVC to use
  existingClaim: ""
  ## @param persistence.selector Selector to match an existing Persistent Volume
  ## selector:
  ##   matchLabels:
  ##     app: my-app
  selector: {}

## File store configuration
fileStore:
  ## @param fileStore.enabled Enable file store persistence
  enabled: true
  ## @param fileStore.storageClass Storage class for file store PVC
  storageClass: ""
  ## @param fileStore.accessModes File store PVC access modes
  accessModes:
    - ReadWriteOnce
  ## @param fileStore.size File store PVC size
  size: 5Gi
  ## @param fileStore.annotations File store PVC annotations
  annotations: {}
  ## @param fileStore.existingClaim Name of an existing PVC to use for file store
  existingClaim: ""

## @section OpenHands Configuration

## Environment variables for OpenHands configuration
## These map to the config.template.toml settings
config:
  ## @param config.llm.apiKey LLM API key (required)
  ## For OpenAI, Anthropic, etc.
  llm:
    apiKey: ""
    ## @param config.llm.model LLM model to use
    model: "gpt-4o"
    ## @param config.llm.baseUrl Custom API base URL
    baseUrl: ""
    ## @param config.llm.customProvider Custom LLM provider
    customProvider: ""
    ## @param config.llm.temperature Temperature for LLM responses
    temperature: 0.0
    ## @param config.llm.maxInputTokens Maximum input tokens
    maxInputTokens: 0
    ## @param config.llm.maxOutputTokens Maximum output tokens
    maxOutputTokens: 0

  ## @param config.core.workspaceBase Base path for workspace
  core:
    workspaceBase: "/opt/workspace_base"
    ## @param config.core.maxIterations Maximum number of iterations
    maxIterations: 500
    ## @param config.core.maxBudgetPerTask Maximum budget per task (0 = no limit)
    maxBudgetPerTask: 0.0
    ## @param config.core.defaultAgent Default agent to use
    defaultAgent: "CodeActAgent"

  ## @param config.sandbox.timeout Sandbox timeout in seconds
  sandbox:
    timeout: 120
    ## @param config.sandbox.userId User ID for sandbox
    userId: 0
    ## @param config.sandbox.useHostNetwork Use host network
    useHostNetwork: false
    ## @param config.sandbox.enableAutoLint Enable auto-linting after editing
    enableAutoLint: false

  ## @param config.security.confirmationMode Enable confirmation mode
  security:
    confirmationMode: false
    ## @param config.security.securityAnalyzer Security analyzer to use (llm, invariant)
    securityAnalyzer: "llm"
    ## @param config.security.enableSecurityAnalyzer Enable security analyzer
    enableSecurityAnalyzer: true

## @section Database Configuration

## PostgreSQL configuration
postgresql:
  ## @param postgresql.enabled Enable PostgreSQL deployment
  enabled: true
  ## @param postgresql.auth.username PostgreSQL username
  auth:
    username: postgres
    ## @param postgresql.auth.password PostgreSQL password
    password: postgres
    ## @param postgresql.auth.database PostgreSQL database name
    database: openhands
  ## @param postgresql.primary.persistence.enabled Enable PostgreSQL persistence
  primary:
    persistence:
      enabled: true
      size: 8Gi

## Redis configuration
redis:
  ## @param redis.enabled Enable Redis deployment
  enabled: true
  ## @param redis.auth.enabled Enable Redis authentication
  auth:
    enabled: true
    ## @param redis.auth.password Redis password
    password: redis
  ## @param redis.master.persistence.enabled Enable Redis persistence
  master:
    persistence:
      enabled: true
      size: 2Gi

## @section External Database Configuration (alternative to postgresql.enabled)

## External PostgreSQL configuration
## Use this if you have an existing PostgreSQL instance
externalDatabase:
  ## @param externalDatabase.enabled Use external PostgreSQL (disables postgresql.enabled)
  enabled: false
  ## @param externalDatabase.host External PostgreSQL host
  host: ""
  ## @param externalDatabase.port External PostgreSQL port
  port: 5432
  ## @param externalDatabase.database External PostgreSQL database name
  database: openhands
  ## @param externalDatabase.username External PostgreSQL username
  username: postgres
  ## @param externalDatabase.password External PostgreSQL password
  password: ""

## External Redis configuration
## Use this if you have an existing Redis instance
externalRedis:
  ## @param externalRedis.enabled Use external Redis (disables redis.enabled)
  enabled: false
  ## @param externalRedis.host External Redis host
  host: ""
  ## @param externalRedis.port External Redis port
  port: 6379
  ## @param externalRedis.password External Redis password
  password: ""

## @param envVars Additional environment variables
## E.g.
## envVars:
##   - name: FOO
##     value: "bar"
envVars: []

## @param envVarsSecret Name of existing Secret containing extra env vars
envVarsSecret: ""

## @section ServiceAccount parameters

## ServiceAccount configuration
serviceAccount:
  ## @param serviceAccount.create Specifies whether a ServiceAccount should be created
  create: true
  ## @param serviceAccount.annotations ServiceAccount annotations
  annotations: {}
  ## @param serviceAccount.name The name of the ServiceAccount to use
  ## If not set and create is true, a name is generated using the fullname template
  name: ""

## @section RBAC parameters

## RBAC configuration
rbac:
  ## @param rbac.create Specifies whether RBAC resources should be created
  create: false
  ## @param rbac.rules Custom RBAC rules to create
  ## Example:
  ## rules:
  ##   - apiGroups: [""]
  ##     resources: ["pods"]
  ##     verbs: ["get", "list"]
  rules: []

## @section Autoscaling parameters

## Autoscaling configuration
autoscaling:
  ## @param autoscaling.enabled Enable Horizontal Pod Autoscaler
  enabled: false
  ## @param autoscaling.minReplicas Minimum number of replicas
  minReplicas: 1
  ## @param autoscaling.maxReplicas Maximum number of replicas
  maxReplicas: 10
  ## @param autoscaling.targetCPUUtilizationPercentage Target CPU utilization percentage
  targetCPUUtilizationPercentage: 80
  ## @param autoscaling.targetMemoryUtilizationPercentage Target Memory utilization percentage
  targetMemoryUtilizationPercentage: 80

## @section Additional parameters

## @param nodeSelector Node labels for pod assignment
## ref: https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/
nodeSelector: {}

## @param tolerations Tolerations for pod assignment
## ref: https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/
tolerations: []

## @param affinity Affinity for pod assignment
## ref: https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity
affinity: {}

## @param podAnnotations Annotations for pods
podAnnotations: {}

## @param podLabels Additional labels for pods
podLabels: {}

## Liveness and readiness probes
## ref: https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/
livenessProbe:
  ## @param livenessProbe.enabled Enable livenessProbe
  enabled: true
  ## @param livenessProbe.initialDelaySeconds Initial delay seconds for livenessProbe
  initialDelaySeconds: 30
  ## @param livenessProbe.periodSeconds Period seconds for livenessProbe
  periodSeconds: 10
  ## @param livenessProbe.timeoutSeconds Timeout seconds for livenessProbe
  timeoutSeconds: 5
  ## @param livenessProbe.failureThreshold Failure threshold for livenessProbe
  failureThreshold: 6
  ## @param livenessProbe.successThreshold Success threshold for livenessProbe
  successThreshold: 1

readinessProbe:
  ## @param readinessProbe.enabled Enable readinessProbe
  enabled: true
  ## @param readinessProbe.initialDelaySeconds Initial delay seconds for readinessProbe
  initialDelaySeconds: 10
  ## @param readinessProbe.periodSeconds Period seconds for readinessProbe
  periodSeconds: 10
  ## @param readinessProbe.timeoutSeconds Timeout seconds for readinessProbe
  timeoutSeconds: 5
  ## @param readinessProbe.failureThreshold Failure threshold for readinessProbe
  failureThreshold: 3
  ## @param readinessProbe.successThreshold Success threshold for readinessProbe
  successThreshold: 1

## @param priorityClassName Priority class name for pods
priorityClassName: ""

## @param hostAliases Add entries to /etc/hosts
hostAliases: []

## @param updateStrategy.type Deployment update strategy type
## ref: https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#strategy
updateStrategy:
  type: RollingUpdate

## @param podDisruptionBudget Pod Disruption Budget configuration
## ref: https://kubernetes.io/docs/tasks/run-application/configure-pdb/
podDisruptionBudget:
  enabled: false
  # minAvailable: 1
  # maxUnavailable: 1
