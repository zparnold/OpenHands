# Example values for a production deployment of OpenHands
# 
# Usage:
#   helm install openhands ./helm/openhands -f helm/openhands/examples/production-values.yaml

# Use production-grade image settings
image:
  pullPolicy: IfNotPresent
  # Specify exact version for reproducibility
  tag: "1.1.0"

# Production replica count (single instance to avoid state conflicts)
replicaCount: 1

# Production resource allocation
resources:
  limits:
    cpu: 4000m
    memory: 8Gi
  requests:
    cpu: 2000m
    memory: 4Gi

# Enable ingress for external access
ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/proxy-body-size: "0"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
  hosts:
    - host: openhands.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: openhands-tls
      hosts:
        - openhands.example.com

# Production persistence settings
persistence:
  enabled: true
  storageClass: "fast-ssd"  # Use fast storage for better performance
  size: 100Gi
  accessModes:
    - ReadWriteOnce

fileStore:
  enabled: true
  storageClass: "standard"
  size: 50Gi

# LLM Configuration
config:
  llm:
    apiKey: ""  # Set via --set or external secret management
    model: "gpt-4o"
    temperature: 0.0
    maxInputTokens: 128000
    maxOutputTokens: 16384
  
  core:
    workspaceBase: "/opt/workspace_base"
    maxIterations: 500
    maxBudgetPerTask: 10.0  # Set budget limit
    defaultAgent: "CodeActAgent"
  
  sandbox:
    timeout: 300  # Longer timeout for production
    userId: 0
    useHostNetwork: false
    enableAutoLint: true  # Enable auto-linting
  
  security:
    confirmationMode: false
    securityAnalyzer: "llm"
    enableSecurityAnalyzer: true

# Enable probes with production settings
livenessProbe:
  enabled: true
  initialDelaySeconds: 60
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 3
  successThreshold: 1

readinessProbe:
  enabled: true
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

# Pod disruption budget for high availability
podDisruptionBudget:
  enabled: false  # Enable if running multiple replicas
  minAvailable: 1

# Service account with annotations for cloud IAM
serviceAccount:
  create: true
  annotations:
    # For AWS EKS with IRSA
    # eks.amazonaws.com/role-arn: arn:aws:iam::ACCOUNT_ID:role/openhands-role
    # For GKE with Workload Identity
    # iam.gke.io/gcp-service-account: openhands@PROJECT_ID.iam.gserviceaccount.com

# Security context
podSecurityContext:
  enabled: true
  fsGroup: 42420
  runAsNonRoot: true

securityContext:
  enabled: true
  runAsUser: 42420
  runAsNonRoot: true
  privileged: false
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  capabilities:
    drop:
      - ALL

# Node selection for production workloads
nodeSelector:
  workload-type: application

# Tolerations for dedicated nodes
tolerations:
  - key: "workload-type"
    operator: "Equal"
    value: "application"
    effect: "NoSchedule"

# Anti-affinity to spread pods across nodes (if running multiple replicas)
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - openhands
          topologyKey: kubernetes.io/hostname

# Additional labels for monitoring
podLabels:
  environment: production
  team: platform

# Additional annotations for monitoring
podAnnotations:
  prometheus.io/scrape: "false"  # Enable if Prometheus metrics are exposed
